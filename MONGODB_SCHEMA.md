# MongoDB Schema Documentation

## Database: receipt-generator

## Collection: receipts

### Schema Definition

```javascript
{
  // Auto-generated by Mongoose
  _id: ObjectId,
  
  // Receipt Identification
  receiptNo: {
    type: String,
    required: true,
    unique: true,
    example: "REC20260275"
  },
  
  receiptDate: {
    type: String,
    required: true,
    format: "DD-Mon-YYYY",
    example: "18-Dec-2025"
  },
  
  // Customer Information
  name: {
    type: String,
    required: true,
    example: "KHANDOBA TOURS AND TRAVELS"
  },
  
  customerId: {
    type: String,
    default: "2458017400",
    fixed: true
  },
  
  address: {
    type: String,
    required: true,
    example: "KURNUR P O, KURNUR, PO:KURNOOR, DIST: SOLAPUR MAHARASHTRA, Pin: 413226"
  },
  
  // Financial Details
  amount: {
    type: Number,
    required: true,
    example: 300000.00
  },
  
  amountInWords: {
    type: String,
    required: true,
    generated: true,
    example: "Rupees Three Lakh Only"
  },
  
  // Bank & Finance
  hypothecatedTo: {
    type: String,
    required: true,
    enum: [
      "AU SMALL FINANCE BANK",
      "State Bank Of India",
      "Cholamandalam Investment and Finance",
      "Federal Bank"
    ]
  },
  
  // Business Information
  proprietor: {
    type: String,
    required: true,
    example: "SAVITA SANJAY GAVALI"
  },
  
  remark: {
    type: String,
    default: "For Vehicle allotment"
  },
  
  orderType: {
    type: String,
    required: true,
    enum: ["TAXI", "Private"]
  },
  
  model: {
    type: String,
    required: true,
    example: "ERTIGA VXI CNG (White)"
  },
  
  // Payment Details
  paymentMode: {
    type: String,
    default: "CASH",
    example: "CASH, CHEQUE, DD, NEFT"
  },
  
  chequeNo: {
    type: String,
    default: "",
    optional: true
  },
  
  depositBank: {
    type: String,
    default: "",
    optional: true
  },
  
  depositDate: {
    type: String,
    default: "",
    optional: true,
    format: "DD-Mon-YYYY"
  },
  
  // Timestamps (auto-managed by Mongoose)
  createdAt: {
    type: Date,
    auto: true
  },
  
  updatedAt: {
    type: Date,
    auto: true
  }
}
```

## Indexes

```javascript
// Unique index on receiptNo for fast lookups and uniqueness
{ receiptNo: 1 }

// Index on createdAt for chronological queries
{ createdAt: -1 }

// Compound index for filtering by date range
{ receiptDate: 1, createdAt: -1 }
```

## Sample Documents

### Example 1: Cash Payment

```json
{
  "_id": "507f1f77bcf86cd799439011",
  "receiptNo": "REC20260275",
  "receiptDate": "18-Dec-2025",
  "name": "KHANDOBA TOURS AND TRAVELS",
  "customerId": "2458017400",
  "address": "KURNUR P O, KURNUR, PO:KURNOOR, DIST: SOLAPUR MAHARASHTRA, Pin: 413226",
  "amount": 300000,
  "amountInWords": "Rupees Three Lakh Only",
  "hypothecatedTo": "AU SMALL FINANCE BANK",
  "proprietor": "SAVITA SANJAY GAVALI",
  "remark": "For Vehicle allotment",
  "orderType": "TAXI",
  "model": "ERTIGA VXI CNG (White)",
  "paymentMode": "CASH",
  "chequeNo": "",
  "depositBank": "",
  "depositDate": "",
  "createdAt": "2025-12-18T10:30:00.000Z",
  "updatedAt": "2025-12-18T10:30:00.000Z"
}
```

### Example 2: Cheque Payment

```json
{
  "_id": "507f1f77bcf86cd799439012",
  "receiptNo": "REC20260451",
  "receiptDate": "20-Dec-2025",
  "name": "MUMBAI CAB SERVICES",
  "customerId": "2458017400",
  "address": "Shop No. 5, Mumbai Naka, Pune, Maharashtra, Pin: 411001",
  "amount": 450000,
  "amountInWords": "Rupees Four Lakh Fifty Thousand Only",
  "hypothecatedTo": "State Bank Of India",
  "proprietor": "RAHUL SHARMA",
  "remark": "For Vehicle allotment",
  "orderType": "Private",
  "model": "INNOVA CRYSTA GX (Silver)",
  "paymentMode": "CHEQUE",
  "chequeNo": "789456",
  "depositBank": "HDFC BANK",
  "depositDate": "20-Dec-2025",
  "createdAt": "2025-12-20T14:15:00.000Z",
  "updatedAt": "2025-12-20T14:15:00.000Z"
}
```

## Query Examples

### Find all receipts for a customer
```javascript
db.receipts.find({ name: "KHANDOBA TOURS AND TRAVELS" })
```

### Find receipts by amount range
```javascript
db.receipts.find({ 
  amount: { $gte: 200000, $lte: 400000 } 
}).sort({ createdAt: -1 })
```

### Find receipts by date
```javascript
db.receipts.find({ 
  receiptDate: "18-Dec-2025" 
})
```

### Get total amount for a month
```javascript
db.receipts.aggregate([
  {
    $match: {
      createdAt: {
        $gte: ISODate("2025-12-01"),
        $lt: ISODate("2026-01-01")
      }
    }
  },
  {
    $group: {
      _id: null,
      totalAmount: { $sum: "$amount" },
      count: { $sum: 1 }
    }
  }
])
```

### Find by bank
```javascript
db.receipts.find({ 
  hypothecatedTo: "AU SMALL FINANCE BANK" 
}).sort({ amount: -1 })
```

## Data Validation Rules

1. **receiptNo**: Must be unique, format: REC + YYYY + 4 digits
2. **amount**: Must be positive number, supports decimals
3. **receiptDate**: String format (DD-Mon-YYYY)
4. **customerId**: Fixed value "2458017400"
5. **hypothecatedTo**: Must be one of predefined banks
6. **orderType**: Must be "TAXI" or "Private"

## Backup Strategy

### Daily Backup Command
```bash
mongodump --uri="your_mongodb_uri" --out=/backup/$(date +%Y%m%d)
```

### Restore Command
```bash
mongorestore --uri="your_mongodb_uri" /backup/20251218
```

## Performance Optimization

1. Create index on receiptNo (done automatically via unique constraint)
2. Create index on createdAt for date-based queries
3. Use projection to fetch only required fields
4. Implement pagination for large result sets

```javascript
// Efficient pagination
const page = 1;
const limit = 20;
const receipts = await Receipt.find()
  .sort({ createdAt: -1 })
  .limit(limit)
  .skip((page - 1) * limit)
  .select('receiptNo name amount receiptDate');
```

## Connection String Format

```
mongodb+srv://<username>:<password>@<cluster>.mongodb.net/<database>?retryWrites=true&w=majority
```

Replace:
- `<username>`: Your MongoDB Atlas username
- `<password>`: Your password (URL encoded)
- `<cluster>`: Your cluster name
- `<database>`: receipt-generator

## Security Best Practices

1. Never commit `.env.local` to version control
2. Use environment variables for connection string
3. Enable IP whitelisting in MongoDB Atlas
4. Use strong passwords
5. Regularly rotate credentials
6. Enable MongoDB Atlas audit logs
7. Use read-only users for reporting queries
